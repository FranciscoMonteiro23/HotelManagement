@page
@using HotelManagement.Models
@model HotelManagement.Pages.Reservas.IndexModel

@{
    ViewData["Title"] = "Reservas";
}

<h1><i class="fas fa-calendar-alt me-2"></i>Reservas</h1>

<p>
    <a asp-page="Create" class="btn btn-primary">
        <i class="fas fa-calendar-plus me-2"></i>Nova Reserva
    </a>
</p>

<!-- FILTRO DE PESQUISA COM STATUS -->
<form asp-page="./Index" method="get" class="mb-4">
    <div class="card shadow-sm border-0">
        <div class="card-body">
            <div class="row align-items-end">
                <div class="col-md-5">
                    <label class="form-label">
                        <i class="fas fa-search me-2"></i>Procurar por cliente, quarto ou tipo:
                    </label>
                    <input type="text" name="FiltroTexto" value="@Model.FiltroCorrente" class="form-control"
                        placeholder="Digite para pesquisar..." />
                </div>
                <div class="col-md-3">
                    <label class="form-label">
                        <i class="fas fa-filter me-2"></i>Filtrar por Status:
                    </label>
                    <select name="statusFiltro" class="form-select" asp-items="Model.StatusList">
                        <option value="">-- Todos os Status --</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-search me-2"></i>Filtrar
                    </button>
                    <a asp-page="./Index" class="btn btn-secondary w-100 mt-2">
                        <i class="fas fa-redo me-2"></i>Limpar Filtros
                    </a>
                </div>
            </div>
        </div>
    </div>
</form>

<!-- BOTÕES DE FILTRO RÁPIDO POR STATUS -->
<div class="mb-3 d-flex flex-wrap gap-2">
    <a asp-page="./Index" asp-route-statusFiltro="Pendente" class="btn btn-outline-warning btn-sm">
        <i class="fas fa-clock me-1"></i>Pendentes
    </a>
    <a asp-page="./Index" asp-route-statusFiltro="Confirmada" class="btn btn-outline-success btn-sm">
        <i class="fas fa-check-circle me-1"></i>Confirmadas
    </a>
    <a asp-page="./Index" asp-route-statusFiltro="CheckInRealizado" class="btn btn-outline-info btn-sm">
        <i class="fas fa-door-open me-1"></i>Check-in Realizados
    </a>
    <a asp-page="./Index" asp-route-statusFiltro="CheckOutRealizado" class="btn btn-outline-secondary btn-sm">
        <i class="fas fa-door-closed me-1"></i>Check-out Realizados
    </a>
    <a asp-page="./Index" asp-route-statusFiltro="Cancelada" class="btn btn-outline-danger btn-sm">
        <i class="fas fa-times-circle me-1"></i>Canceladas
    </a>
</div>

<!-- TABELA DE RESERVAS -->
<div class="card shadow-sm border-0">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead class="table-light">
                    <tr>
                        <th><i class="fas fa-hashtag me-1"></i>ID</th>
                        <th>
                            <a asp-page="./Index" asp-route-ordenacao="@Model.OrdenacaoCliente"
                                asp-route-filtroCorrente="@Model.FiltroCorrente"
                                asp-route-statusFiltro="@Model.StatusCorrente"
                                asp-route-indexPagina="@Model.Reservas.PaginaIndex" class="text-decoration-none">
                                <i class="fas fa-user me-1"></i>Cliente
                                @if (Model.OrdenacaoCliente == "cliente_desc")
                                {
                                    <i class="fas fa-sort-up"></i>
                                }
                                else
                                {
                                    <i class="fas fa-sort-down"></i>
                                }
                            </a>
                        </th>
                        <th><i class="fas fa-door-closed me-1"></i>Quarto</th>
                        <th>
                            <a asp-page="./Index" asp-route-ordenacao="@Model.OrdenacaoData"
                                asp-route-filtroCorrente="@Model.FiltroCorrente"
                                asp-route-statusFiltro="@Model.StatusCorrente"
                                asp-route-indexPagina="@Model.Reservas.PaginaIndex" class="text-decoration-none">
                                <i class="fas fa-calendar me-1"></i>Check-in
                                @if (Model.OrdenacaoData == "data_desc")
                                {
                                    <i class="fas fa-sort-up"></i>
                                }
                                else
                                {
                                    <i class="fas fa-sort-down"></i>
                                }
                            </a>
                        </th>
                        <th><i class="fas fa-calendar me-1"></i>Check-out</th>
                        <th><i class="fas fa-moon me-1"></i>Noites</th>
                        <th>
                            <a asp-page="./Index" asp-route-ordenacao="@Model.OrdenacaoValor"
                                asp-route-filtroCorrente="@Model.FiltroCorrente"
                                asp-route-statusFiltro="@Model.StatusCorrente"
                                asp-route-indexPagina="@Model.Reservas.PaginaIndex" class="text-decoration-none">
                                <i class="fas fa-euro-sign me-1"></i>Valor
                                @if (Model.OrdenacaoValor == "valor_desc")
                                {
                                    <i class="fas fa-sort-up"></i>
                                }
                                else
                                {
                                    <i class="fas fa-sort-down"></i>
                                }
                            </a>
                        </th>
                        <th><i class="fas fa-info-circle me-1"></i>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.Reservas)
                    {
                        <tr>
                            <td>
                                <span class="badge bg-secondary">#@item.ReservaID</span>
                            </td>
                            <td>
                                <strong>@item.Cliente.NomeCompleto</strong>
                            </td>
                            <td>
                                <span class="badge bg-dark">@item.Quarto.QuartoID</span>
                                <small class="text-muted">- @item.Quarto.TipoQuarto</small>
                            </td>
                            <td>
                                <i class="fas fa-calendar-check me-1 text-success"></i>
                                @item.DataCheckIn.ToString("dd/MM/yyyy")
                            </td>
                            <td>
                                <i class="fas fa-calendar-times me-1 text-danger"></i>
                                @item.DataCheckOut.ToString("dd/MM/yyyy")
                            </td>
                            <td>
                                <span class="badge bg-info">@item.NumeroNoites</span>
                            </td>
                            <td>
                                <span class="badge bg-success">@item.ValorTotal.ToString("C")</span>
                            </td>
                            <td>
                                @switch (item.Status)
                                {
                                    case StatusReserva.Confirmada:
                                        <span class="badge bg-success">
                                            <i class="fas fa-check-circle me-1"></i>Confirmada
                                        </span>
                                        break;
                                    case StatusReserva.Pendente:
                                        <span class="badge bg-warning">
                                            <i class="fas fa-clock me-1"></i>Pendente
                                        </span>
                                        break;
                                    case StatusReserva.Cancelada:
                                        <span class="badge bg-danger">
                                            <i class="fas fa-times-circle me-1"></i>Cancelada
                                        </span>
                                        break;
                                    case StatusReserva.CheckInRealizado:
                                        <span class="badge bg-info">
                                            <i class="fas fa-door-open me-1"></i>Check-in
                                        </span>
                                        break;
                                    case StatusReserva.CheckOutRealizado:
                                        <span class="badge bg-secondary">
                                            <i class="fas fa-door-closed me-1"></i>Check-out
                                        </span>
                                        break;
                                }
                            </td>
                            <td>
                                <a asp-page="./Edit" asp-route-id="@item.ReservaID" class="btn btn-sm btn-warning"
                                    title="Editar">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <a asp-page="./Details" asp-route-id="@item.ReservaID" class="btn btn-sm btn-info"
                                    title="Detalhes">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <a asp-page="./Delete" asp-route-id="@item.ReservaID" class="btn btn-sm btn-danger"
                                    title="Apagar">
                                    <i class="fas fa-trash"></i>
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- PAGINAÇÃO -->
@{
    var prevDisabled = !Model.Reservas.HaPaginasAntes ? "disabled" : "";
    var nextDisabled = !Model.Reservas.HaPaginasDepois ? "disabled" : "";
}

<div class="d-flex justify-content-between align-items-center mt-3">
    <div>
        <span class="text-muted">
            <i class="fas fa-info-circle me-2"></i>
            Página @Model.Reservas.PaginaIndex de @Model.Reservas.TotalPaginas
        </span>
    </div>
    <div>
        <a asp-page="./Index" asp-route-ordenacao="@Model.OrdenacaoCorrente"
            asp-route-indexPagina="@(Model.Reservas.PaginaIndex - 1)" asp-route-filtroCorrente="@Model.FiltroCorrente"
            asp-route-statusFiltro="@Model.StatusCorrente" class="btn btn-primary @prevDisabled">
            <i class="fas fa-chevron-left me-2"></i>Anterior
        </a>
        <a asp-page="./Index" asp-route-ordenacao="@Model.OrdenacaoCorrente"
            asp-route-indexPagina="@(Model.Reservas.PaginaIndex + 1)" asp-route-filtroCorrente="@Model.FiltroCorrente"
            asp-route-statusFiltro="@Model.StatusCorrente" class="btn btn-primary @nextDisabled">
            Próximo<i class="fas fa-chevron-right ms-2"></i>
        </a>
    </div>
</div>